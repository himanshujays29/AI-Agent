<!-- history-detail.ejs -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Exam Prep Dashboard</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.1.0/github-markdown-light.css"
    />
    <link rel="stylesheet" href="/css/style.css" />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  </head>

  <body class="bg-gray-100">
    <div class="max-w-3xl mx-auto py-10 markdown-body">
      <a
        href="/history"
        class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 mb-6 inline-block"
        >â¬… Back to History</a
      >
      <h1 class="text-3xl font-bold mb-4"><%= record.topic %></h1>
      <p class="text-sm text-gray-500 mb-6">
        <%= record.createdAt.toDateString() %>
      </p>

      <div class="bg-white p-4 rounded-lg shadow mb-6">
        <h2 class="text-2xl font-semibold mb-2">ğŸ” Research</h2>
        <div class="prose"><%- marked.parse(record.research) %></div>
      </div>

      <div class="bg-white p-4 rounded-lg shadow">
        <h2 class="text-2xl font-semibold mb-2">ğŸ§  Summary</h2>
        <div class="prose"><%- marked.parse(record.summary) %></div>
      </div>
      <a
        id="generateQuizHistory"
        class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 mt-4 inline-block"
      >
        ğŸ¯ Generate Quiz for this topic
      </a>

      <div
        id="quizBox"
        class="hidden markdown-body bg-white p-4 rounded-lg shadow mt-4"
      ></div>
      <a
        href="/api/pdf/<%= record._id %>"
        class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 inline-block"
      >
        ğŸ“„ Export as PDF
      </a>
      <br /><br />

      <div style="margin-top: 30px">
        <form action="/history/delete/<%= record._id %>" method="POST">
          <button class="delete-detail-btn">
            <i class="fas fa-trash"></i> Delete This History
          </button>
        </form>
      </div>
    </div>
  </body>
  <script>
    document.getElementById("generateQuizHistory").onclick = async () => {
      const btn = document.getElementById("generateQuizHistory");
      btn.innerText = "â³ Generating quiz...";

      const res = await fetch(`/api/quiz/<%= record._id %>`);
      const data = await res.json();

      btn.innerText = "ğŸ¯ Regenerate Quiz";

      document.getElementById("quizBox").innerHTML = marked.parse(data.quiz);
      document.getElementById("quizBox").classList.remove("hidden");
    };
  </script>
</html>
