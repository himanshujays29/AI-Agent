<% layout('/layout/layout') -%>
<div class="max-w-3xl mx-auto py-10 markdown-body">
  <a
    href="/history"
    class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 mb-6 inline-block"
    >â¬… Back to History</a
  >
  <h1 class="text-3xl font-bold mb-4"><%= record.topic %></h1>
  <p class="text-sm text-gray-500 mb-6">
    <%= record.createdAt.toDateString() %>
  </p>

  <div class="bg-white p-4 rounded-lg shadow mb-6">
    <h2 class="text-2xl font-semibold mb-2">ğŸ” Research</h2>
    <div class="prose"><%- marked.parse(record.research) %></div>
  </div>

  <div class="bg-white p-4 rounded-lg shadow">
    <h2 class="text-2xl font-semibold mb-2">ğŸ§  Summary</h2>
    <div class="prose"><%- marked.parse(record.summary) %></div>
  </div>
  <a
    id="generateQuizHistory"
    class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 mt-4 inline-block"
  >
    ğŸ¯ Generate Quiz for this topic
  </a>

  <div
    id="quizBox"
    class="hidden markdown-body bg-white p-4 rounded-lg shadow mt-4"
  ></div>
  <a
    href="/api/pdf/<%= record._id %>"
    class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 inline-block"
  >
    ğŸ“„ Export as PDF
  </a>
  <br /><br />
  <label>Select Model:</label>
  <select id="regenModelSelect" class="model-dropdown">
    <option value="gemini-2.5-flash-lite">Gemini-2.5-Flash-Lite (Best)</option>
    <option value="gemini-2.5-flash">Gemini-2.5-Flash</option>
  </select>
  <form
    action="/history/regenerate/<%= record._id %>"
    method="POST"
    style="margin-top: 20px"
  >
    <button
      type="button"
      class="regen-btn"
      id="regen-btn"
      onclick="regenerateNotes('<%= record._id %>')"
    >
      <i class="fa-solid fa-rotate-right"></i> Regenerate Notes
    </button>
  </form>

  <div id="regenLoader" style="display: none; margin-top: 15px">
    <i
      class="fa-solid fa-spinner fa-spin"
      style="font-size: 24px; color: #007bff"
    ></i>
    <span id="regenLoaderText">Regeneratingâ€¦ please wait</span>
  </div>

  <div style="margin-top: 30px">
    <form action="/history/delete/<%= record._id %>" method="POST">
      <button class="delete-detail-btn">
        <i class="fas fa-trash"></i> Delete This History
      </button>
    </form>
  </div>
</div>
