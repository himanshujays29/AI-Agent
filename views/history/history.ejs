<% layout('/layout/layout') -%>
<div class="max-w-5xl mx-auto py-6 px-3 md:px-8">
  <!-- Header: Stacks on mobile, Row on Desktop -->
  <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
    <h1 class="text-3xl font-bold text-center md:text-left">ðŸ“œ Study History</h1>
    <a
      href="/"
      class="minimal-btn"
    >
      â¬… Back to Dashboard
    </a>
  </div>

  <% if (records.length === 0) { %>
  <p class="text-chatgpt-subtle text-center">No study records found yet.</p>
  <% } else { %>
  
  <ul class="card p-0 overflow-hidden">
    <% records.forEach(r => { %>
    <li class="p-4 hover:bg-chatgpt-soft-hover transition border-b border-chatgpt-border last:border-0">
      
      <!-- List Item: Column on Mobile, Row on Small Screens+ -->
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center">
        
        <!-- Topic & Date -->
        <div class="w-full sm:w-auto">
          <h2 class="text-xl font-semibold histrow"><%= r.topic %></h2>
          <p class="text-sm text-chatgpt-subtle"><%= r.createdAt.toDateString() %></p>
        </div>

        <!-- Action Buttons Group -->
        <!-- Added w-full for mobile to space buttons out evenly or align them -->
        <div class="flex items-center justify-between sm:justify-end gap-3 w-full sm:w-auto mt-2 sm:mt-0">
          
          <a href="/history/<%= r._id %>" class="text-blue-600 hover:underline text-sm font-medium px-2 py-1"
            >View</a
          >

          <div class="flex items-center gap-3">
            <form
              action="/history/regenerate/<%= r._id %>"
              method="POST"
              style="display: flex"
            >
              <select class="model-dropdown-small sm:inline-block" id="model-<%= r._id %>">
                <option value="gemini-2.5-flash-lite">
                   Flash-Lite
                </option>
                <option value="gemini-2.5-flash">Flash</option>
              </select>

              <button
                class="cursor-pointer text-blue-600 hover:text-blue-800 transition px-2 py-1"
                type="button"
                onclick="regenFromList('<%= r._id %>')"
                title="Regenerate Notes"
              >
                <i class="fa-solid fa-rotate-right"></i>
                <i
                  class="fa-solid fa-spinner fa-spin"
                  id="spinner-<%= r._id %>"
                  style="font-size: 18px; color: #007bff; display: none"
                ></i>
              </button>
            </form>

            <form
              action="/history/delete/<%= r._id %>"
              method="POST"
              style="display: inline"
              onsubmit="return confirm('Are you sure you want to delete this?');"
            >
              <button class="delete-btn px-2 py-1">
                <i class="fas fa-trash"></i>
              </button>
            </form>
          </div>
        </div>

      </div>
    </li>
    <% }) %>
  </ul>
  <% } %>
</div>